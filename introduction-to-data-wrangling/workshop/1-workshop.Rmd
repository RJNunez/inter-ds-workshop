---
title: 'Workshop: Introduction to Data Wrangling I'
author: "Rolando J. Acosta"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

```{r setup, include=FALSE}
# -- Options
knitr::opts_chunk$set(
	echo    = TRUE,
	message = FALSE,
	warning = FALSE
)

# -- Libraries
library(tidyverse)
```

1. Load the `cdc-excess-deaths-data.rda` file in the `datasets` folder and get acquainted with the data.

```{r}
# -- Loading data
load("../datasets/cdc-excess-deaths-data.rda")

# -- Displaying data
knitr::kable(head(excess_deaths_dat))
```

2. Change the name of the columns to: `date`, `state`, `deaths`, `threshold`, `average`, `type`, `outcome`.

```{r}
# -- Changing the variable names
excess_deaths_dat <- excess_deaths_dat %>%
  setNames(c("date", "state", "deaths", "threshold", "average", "type", "outcome"))

# -- Displaying data
knitr::kable(head(excess_deaths_dat))
```
3. Create a figure where you plot `date` on the *x-axis* and `deaths` on the *y-axis* for Puerto Rico. Only use *unweighted* data. Label the axes accordingly and add a title to the figure.

```{r, fig.height = 4, fig.width = 10, dpi = 300}
# -- Code to create figure
excess_deaths_dat %>%
  filter(state == "Puerto Rico",
         type  == "Unweighted") %>%
  ggplot(aes(date, deaths)) +
  geom_point(alpha = 0.50,
             size  = 2) +
  scale_x_date(date_labels = "%b %Y",
               date_breaks = "3 months") +
  labs(x     = "Date",
       y     = "Number of deaths",
       title = "Weekly all-cause deaths in Puerto Rico") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

- What do you notice? 

*A few bumps in the number of deaths*

*A big decrease in the number of deaths towards the end of the time series*

- Can you explain the bumps? 

*There is a huge increase in the number of deaths around October 2017 which is associated with Hurricane Maria*

*The increase around January 2019 is normal and associated with seasonal behavior*

*Starting in July 2020, there is an increase in the number of deaths associated with COVID-19*

- Whatâ€™s happening towards the end of the time series? 

*The decrease is explained by reporting lags*

- How can you fix it?

*Implement a weighting scheme*

*Don't use recent data*

4. Create a new data set with data until the end of March 2022. Create a figure where you plot `date` on the *x-axis* and `deaths` on the *y-axis* for Puerto Rico using the newly created dataset. Only use *unweighted* data. Label the axes accordingly and add a title to the figure.

```{r, fig.height = 4, fig.width = 10, dpi = 300}
# -- Subsetting data
excess_deaths_subdat <- excess_deaths_dat %>%
  filter(date <= "2022-03-31")

# -- Code to create figure
excess_deaths_subdat %>%
  filter(state == "Puerto Rico",
         type  == "Unweighted") %>%
  ggplot(aes(date, deaths)) +
  geom_point(alpha = 0.50,
             size  = 2) +
  scale_x_date(date_labels = "%b %Y",
               date_breaks = "3 months") +
  labs(x        = "Date",
       y        = "Number of deaths",
       title    = "Weekly all-cause deaths in Puerto Rico",
       subtitle = "Using data until March 2022") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

